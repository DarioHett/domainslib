<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Task (domainslib.Domainslib.Task)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">domainslib</a> &#x00BB; <a href="../index.html">Domainslib</a> &#x00BB; Task</nav><header class="odoc-preamble"><h1>Module <code><span>Domainslib.Task</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type" id="type-task" class="anchored"><a href="#type-task" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a task</span></span><span> = <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Type of task</p></div></div><div class="odoc-spec"><div class="spec type" id="type-promise" class="anchored"><a href="#type-promise" class="anchor"></a><code><span><span class="keyword">type</span> <span>!'a promise</span></span></code></div><div class="spec-doc"><p>Type of promises</p></div></div><div class="odoc-spec"><div class="spec type" id="type-pool" class="anchored"><a href="#type-pool" class="anchor"></a><code><span><span class="keyword">type</span> pool</span></code></div><div class="spec-doc"><p>Type of task pool</p></div></div><div class="odoc-spec"><div class="spec value" id="val-setup_pool" class="anchored"><a href="#val-setup_pool" class="anchor"></a><code><span><span class="keyword">val</span> setup_pool : <span>?name:string <span class="arrow">&#45;&gt;</span></span> <span>num_domains:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-pool">pool</a></span></code></div><div class="spec-doc"><p>Sets up a task execution pool with <code>num_domains</code> new domains. If <code>name</code> is provided, the pool is mapped to <code>name</code> which can be looked up later with <code>lookup_pool name</code>.</p><p>When <code>num_domains</code> is 0, the new pool will be empty, and when an empty pool is in use, every function in this module will run effectively sequentially, using the calling domain as the only available domain.</p><p>Raises <code>Invalid_argument</code> when <code>num_domains</code> is less than 0.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-teardown_pool" class="anchored"><a href="#val-teardown_pool" class="anchor"></a><code><span><span class="keyword">val</span> teardown_pool : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Tears down the task execution pool.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-lookup_pool" class="anchored"><a href="#val-lookup_pool" class="anchor"></a><code><span><span class="keyword">val</span> lookup_pool : <span>string <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-pool">pool</a> option</span></span></code></div><div class="spec-doc"><p><code>lookup_pool name</code> returns <code>Some pool</code> if <code>pool</code> is associated to <code>name</code> or returns <code>None</code> if no value is associated to it.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_num_domains" class="anchored"><a href="#val-get_num_domains" class="anchor"></a><code><span><span class="keyword">val</span> get_num_domains : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>get_num_domains pool</code> returns the total number of domains in <code>pool</code> including the parent domain.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-task">task</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>run p t</code> runs the task <code>t</code> synchronously with the calling domain and the domains in the pool <code>p</code>. If the task <code>t</code> blocks on a promise, then tasks from the pool <code>p</code> are executed until the promise blocking <code>t</code> is resolved.</p><p>This function should be used at the top level to enclose the calls to other functions that may await on promises. This includes <a href="#val-await"><code>await</code></a>, <a href="#val-parallel_for"><code>parallel_for</code></a> and its variants. Otherwise, those functions will raise <code>Unhandled</code> exception.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-async" class="anchored"><a href="#val-async" class="anchor"></a><code><span><span class="keyword">val</span> async : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-task">task</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-promise">promise</a></span></span></code></div><div class="spec-doc"><p><code>async p t</code> runs the task <code>t</code> asynchronously in the pool <code>p</code>. The function returns a promise <code>r</code> in which the result of the task <code>t</code> will be stored.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-await" class="anchored"><a href="#val-await" class="anchor"></a><code><span><span class="keyword">val</span> await : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-promise">promise</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>await p r</code> waits for the promise <code>r</code> to be resolved. During the resolution, other tasks in the pool <code>p</code> might be run using the calling domain and/or the domains in the pool <code>p</code>. If the task associated with the promise have completed successfully, then the result of the task will be returned. If the task have raised an exception, then <code>await</code> raises the same exception.</p><p>Must be called with a call to <a href="#val-run"><code>run</code></a> in the dynamic scope to handle the internal algebraic effects for task synchronization.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parallel_for" class="anchored"><a href="#val-parallel_for" class="anchor"></a><code><span><span class="keyword">val</span> parallel_for : 
  <span>?chunk_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>start:int <span class="arrow">&#45;&gt;</span></span>
  <span>finish:int <span class="arrow">&#45;&gt;</span></span>
  <span>body:<span>( <span>int <span class="arrow">&#45;&gt;</span></span> unit )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>parallel_for c s f b p</code> behaves similar to <code>for i=s to f do b i done</code>, but runs the for loop in parallel with the calling domain and/or the domains in the pool <code>p</code>. The chunk size <code>c</code> determines the number of body applications done in one task; this will default to <code>max(1, (finish-start + 1) / (8 *
    num_domains))</code>. Individual iterations may be run in any order. Tasks are distributed to the participating domains using a divide-and-conquer scheme.</p><p>Must be called with a call to <a href="#val-run"><code>run</code></a> in the dynamic scope to handle the internal algebraic effects for task synchronization.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parallel_for_reduce" class="anchored"><a href="#val-parallel_for_reduce" class="anchor"></a><code><span><span class="keyword">val</span> parallel_for_reduce : 
  <span>?chunk_size:int <span class="arrow">&#45;&gt;</span></span>
  <span>start:int <span class="arrow">&#45;&gt;</span></span>
  <span>finish:int <span class="arrow">&#45;&gt;</span></span>
  <span>body:<span>( <span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>parallel_for_reduce c s f b p r i</code> is similar to <code>parallel_for</code> except that the result returned by each iteration is reduced with <code>r</code> with initial value <code>i</code>. The reduce operations are performed in an arbitrary order and the reduce function needs to be associative in order to obtain a deterministic result.</p><p>Must be called with a call to <a href="#val-run"><code>run</code></a> in the dynamic scope to handle the internal algebraic effects for task synchronization.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-parallel_scan" class="anchored"><a href="#val-parallel_scan" class="anchor"></a><code><span><span class="keyword">val</span> parallel_scan : <span><a href="#type-pool">pool</a> <span class="arrow">&#45;&gt;</span></span> <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> array</span></span></code></div><div class="spec-doc"><p><code>parallel_scan p op a</code> computes the scan of the array <code>a</code> in parallel with binary operator <code>op</code> and returns the result array, using the calling domain and/or the domains in the pool <code>p</code>. Scan is similar to <code>Array.fold_left</code> but returns an array of reduced intermediate values. The reduce operations are performed in an arbitrary order and the reduce function needs to be associative in order to obtain a deterministic result.</p><p>Must be called with a call to <a href="#val-run"><code>run</code></a> in the dynamic scope to handle the internal algebraic effects for task synchronization.</p></div></div></div></body></html>